define("BeMarketing",["jquery","Common","validate"],function(c,b,d){var a=Class.extend({init:function(){this.initVdt();this.bindLis();this.choosePrg(0)},url:{},selfObj:{},initVdt:function(){this.vdtObj={};this.vdtObj.mktAccntFmVdt=new d({formID:"mktAccntFm",onfocusout:true,rules:{department:{required:true,maxlength:50},realName:{required:true,maxlength:50},idCardNo:{required:true,isIdCardNo:true}},messages:{department:{maxlength:"最大长度为50"},realName:{maxlength:"最大长度为50"}}})},bindLis:function(){c("#mktAccntNxt").click(this,this.applyMarketAccount)},choosePrg:function(f,h){var e;if(h){e=c("#"+h).find(".mp-updAccount-prg-itm")}else{e=c(".mp-updAccount-prg-itm")}e.removeClass("mp-updAccount-prg-itm-active");c(e[f-1]).addClass("mp-updAccount-prg-itm-active");c(".js-prg").hide();c(".js-prg-"+f).show();for(var g=0;g<=f;g++){c(".js-prg-"+g+"more").show()}},openMktAccnt:function(e){this.selfObj.MktAccntDg=layer.open({type:1,title:false,fix:false,closeBtn:0,skin:"beMkt",resize:false,area:["940px","490px"],content:c("#mp-updAccount-prg-main"),success:e})},applyMarketAccount:function(f){var g=f.data;if(g.vdtObj.mktAccntFmVdt.validateForm()){b.sendFormData(mpUrlsObj.brMkt.applyMarketAccount,function(e){if(e.isSuccess){g.choosePrg(3)}else{alert(e.resultMsg)}},c("#mktAccntFm").serialize())}},DOMId:{loginName:"loginName",updAccountBtn:"updAccountBtn"},queryUser:function(e){var f=this;b.sendFormData(mpUrlsObj.brMkt.queryUser,function(i){if(i.isSuccess){var g=i.data.status;if(g==1||g==2){var h=function(){if(g==1){var l=c("#"+f.DOMId.loginName);l.html(i.data.loginName);var n=i.type;var m=c("#"+f.DOMId.updAccountBtn);var o=function(p){m.html("完善账户信息成为营销账户");switch(p){case 1:window.open(mpUrlsObj.brMkt.bindMobile);break;case 2:window.open(mpUrlsObj.brMkt.bindEmail);break;case 3:f.choosePrg(2)}m[0].onclick=function(){f.queryUser(true)}};if(!i.data.mobile){m.html("去绑定手机号码");layer.tips("手机号没有绑定","#"+f.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});m[0].onclick=function(){o(1)}}else{if(!i.data.email){m.html("去绑定邮箱");layer.tips("邮箱没有绑定","#"+f.DOMId.updAccountBtn,{tips:[1,"#de143a"],time:3000});m[0].onclick=function(){o(2)}}else{m.html("完善账户信息成为营销账户");m[0].onclick=function(){o(3)}}}}else{f.choosePrg(3)}};if(!e){f.openMktAccnt(h)}else{h()}}}else{var j=i.data.loginUrl;var k=window.location.href;location.href=j+"?returnUrl="+k}})}});return a});